# Load Balancing Rules Overview

<br>

### Sabse Pehle ‚Äì Algorithm Ki Zaroorat Hi Kyun?

Load Balancer ka main kaam:
- üëâ Incoming traffic ko backend servers ke beech distribute karna.

Lekin question:
- ‚ùì Kaise distribute kare?
  - Random?
  - Order mein?
  - Fastest server ko?
  - Least busy ko?
 
Isi decision logic ko bolte hain: **Load Balancing Algorithm**.

Matlab Load Balancing Algorithm se hi Load Balancer decide karta hai ki incoming request ko konse backend server pe bhejna hai. 

<br>
<br>

### Load Balancing Algorithms Kitne Type ki Hoti Hain

Load Balancing Algorithms two types ki hoti hain:
- Static Load Balancing Algorithm.
  - Round-Robin Algorithm.
  - Weighted Round-Robin.
  - IP Hash.
- Dynamic Load Balancing Algorithms.
  - Least-Connection Method.
  - Least-Response Time.
  - Weighted Least Connection.
 
<br>
<br>

### Static Load Balancing Algorithms

Static Load Balancing algorithms wo algorithms hote hain jahan traffic distribute karne ka decision pehle se set kiye gaye fixed rules par based hota hai.

Iska matlab hai ki ye algorithms predefined rules ke according backend se vm select karte hain traffic ko distribute karne ke liye.

Ye algorithms "Real-time" data ko nahi dekhte. Matlab, Load Balancer ye check nahi karta ki server kitna busy hai, uski CPU utilization kitni hai, ya wo kitna slow respond kar raha hai. Load Balancer bas apne pehle se bane hue rules ko follow karke backend se vm select karta hai aur traffic us vm par bhejta hai.

In algorithms ke types hain:
- Round-Robin Algorithm.
- Weighted Round-Robin.
- IP Hash.

<br>
<br>

### Round Robin Algorithm

Ye sabse basic aur simple algorithm hai.

Round Robin ka basic idea hai ki incoming requests ko sequential order mein servers ke beech distribute karna ‚Äî ek ek karke, cyclic manner mein.

Iska matlab hai ki round-robin algorithm incoming requests ko ek ke baad ek server pe distribute karti hai cyclic manner mein.

**Example**:

Imagine karo tumhare paas multiple backend servers hain:
- Server A.
- Server B.
- Server C.

Load Balancer kya karega ki:
- 1st request ‚Üí A.
- 2nd request ‚Üí B.
- 3rd request ‚Üí C.
- 4th request ‚Üí A (cycle repeat).
- 5th request ‚Üí B.
- 6th request ‚Üí C.

Aur ye loop chalta rahega.

Ismein koi intelligence nahi hoti jaise:
- ‚ùå Server load check karna.
- ‚ùå CPU utilization dekhna.
- ‚ùå Fast/slow server detect karna.

<br>

**Algorithm Internally Kaise Kaam Karta Hai?**:

Conceptually ek pointer / index counter maintain hota hai.

Example:

Total backends = 3

Index values:
- 0 ‚Üí Server A.
- 1 ‚Üí Server B.
- 2 ‚Üí Server C.

Har request pe:
```
selected_server = backends[current_index]
current_index = (current_index + 1) % total_backends
```

Yahan % (modulo) ensure karta hai ki index rotate kare.

Execution:

| Request | Current Index | Server |
| ------- | ------------- | ------ |
| Req 1   | 0             | A      |
| Req 2   | 1             | B      |
| Req 3   | 2             | C      |
| Req 4   | (3 % 3 = 0)   | A      |

Simple circular rotation.

<br>

**Round-Robin Algorithm kaha best hai**:

Jab aapke saare backend servers ki configuration (RAM, CPU, Storage) bilkul identical (ek jaisi) ho tab ye algorithm sahi hoti hai.

<br>

**Problem kaha aati hai**:

Problem tab hoti hai jab servers unequal hon matlab kisi server ki configuration high aur kisi ki low.

Example:
- Server A ‚Üí Powerful (16 CPU cores).
- Server B ‚Üí Weak (2 CPU cores).

To is case mein round robin algorithm Server B (Weak Server) pe fir bhi traffic ko bhejta jayega jisse Server B overload ho sakta hai aur down ho jayega.

Result:
- Server A: Underutilized.
- Server B: Overload.

<br>
<br>

### Weighted Round Robin

Weighted Round-Robin algorithm Round-Robin algorithm ka updated version hai ya smart version hai.

Weighted Round Robin (WRR) ko samajhne ke liye pehle ek simple sawal:
- Agar saare servers equal capacity ke nahi hain, to kya unko equal traffic dena logical hai?

Bilkul nahi.

Isi problem ko solve karta hai Weighted Round Robin.

Weighted Round Robin algorithm mein servers ko unki configuration ke hisab se ek weight matlab ek number assign kar dete hain, fir jitna jyada server ka weight hoga us server pe utna jyada traffic bheja jata hai.

Har server ko weight (priority / capacity value) assign hoti hai.

Higher weight ‚áí More requests

**Example**:

Suppose load balancer ke backend mein 3 servers hain:
- Server A (8 CPU & 32 GB RAM).
- Server B (4 CPU & 16 GB RAM).
- Server C (2 CPU & 8 GB RAM).

To in servers ko inki capacity ya configuration ke hisaab se ek weight assign kar denge.

- Server A (8 CPU & 32 GB RAM) = **6**.
- Server B (4 CPU & 16 GB RAM) = **3**.
- Server C (2 CPU & 8 GB RAM) = **2**.

Execution:

- Request 1 = Server A.
- Request 2 = Server A.
- Request 3 = Server A.
- Request 4 = Server B.
- Request 5 = Server B.
- Request 6 = Server c.

Repeat

- Request 7 = Server A.
- Request 8 = Server A.

Ese hi servers request distribute hoti hain.

Notice:
- A gets 3/6 traffic = 50%.
- B gets 2/6 traffic = 33%.
- C gets 1/6 traffic = 17%.

<br>

**Practical Server Example**:

Backend pool:
- Server A ‚Üí 8 CPU cores ‚Üí Weight 4.
- Server B ‚Üí 4 CPU cores ‚Üí Weight 2.
- Server C ‚Üí 2 CPU cores ‚Üí Weight 1.

Total weight = 7

Traffic pattern per 7 requests:
- A, A, A, A, B, B, C

<br>

**Weighted Round-Robin Algorithm Kaha Best Hai**:

Jab aapke cluster mein purane aur naye servers mix hon. Naye servers ko zyada weight de kar aap unhe zyada kaam de sakte hain.


<br>
<br>

### IP Hash Algorithm

IP Hash algorithm mein client ke IP address se ek hash value banti hai, aur us hash ke basis par decide hota hai kaunsa backend server request handle karega.

Iska matlab:
- Same Client IP.
- Same Hash.
- Same backend server (jab tak backend healthy hai).

Is algorithm mein Client ke IP address ke basis pe backend server select kiya jata hai.

**Example**:

Socho tumhare paas 3 backend servers hain:
- Server A.
- Server B.
- Server C.

Total backends = 3

Step 1Ô∏è‚É£: Client Request Aata Hai

Client IP
```
192.168.1.10
```

Step 2Ô∏è‚É£: Hash Function Apply Hota Hai
```
hash("192.168.1.10") = 84523   (example)
```

Step 3Ô∏è‚É£: Modulo Operation
```
84523 % 3 = 2
```
3 = Total Servers

Step 4Ô∏è‚É£: Backend Selection

Index mapping:
- 0 ‚Üí Server A.
- 1 ‚Üí Server B.
- 2 ‚Üí Server C.

Request goes to Server C


Same Client Dubara Aaya?

Same IP ‚áí Same hash ‚áí Same modulo ‚áí Same server

- Session consistency.
- Predictable routing.

**Kyu Use Karte hain**:

Agar aapne kisi website par login kiya hai aur aapka session data Server A par store hai, toh IP Hash ensure karega ki aapki har agli request Server A par hi jaye. Agar aap Server B par chale gaye, toh aap log-out ho jayenge kyunki Server B ke paas aapka session nahi hai.

<br>
<br>
<br>

### Dynamic Load Balancing Algorithm

Dynamic Load Balancing Algorithm real time mein backend server ki **real-time health**, **current traffic**, aur **performance** ko har second monitor karte hain aur phir decide karte hain ki request konse backend server pe bhejni hai.

Agar ek server par zyada load hai ya wo slow ho gaya hai, toh dynamic load balancer usse bypass karke kisi free server ko traffic bhej dega.

Ye algorithm real-time mein decision leti hain ki konse backend server par request bhejni hai.

In algorithm ke types hain:
- Least-Connection Method.
- Least-Response Time.
- Weighted Least Connection.

<br>
<br>

### Least-Connection Method:

Least-Connection Method algorithm ka basic idea hai ki jis backend server ke paas sabse kam active connections hain, nayi request usko bhejo.

Yahan decision request order pe nahi hota (Round Robin jaisa), aur na hi client identity pe (IP Hash jaisa).

Decision purely based on:
- Current server load (connection count).

Example:
- Agar Server A par 50 log hain aur Server B par sirf 10, toh naya user Server B ke paas jayega.

<br>

**Algorithm Ka Core Logic**:

Isme har backend server ke liye Load Balancer maintain karta hai:
- Active connection counter.

Example:
| Server | Active Connections |
| ------ | ------------------ |
| A      | 10                 |
| B      | 3                  |
| C      | 7                  |

New request ‚Üí Server B

Kyuki Server B pe sabse kam request hain.

<br>

**Internally Kaise Kaam Karta Hai?**:

Load Balancer continuously track karta hai:
- Kitne TCP connections open hain.
- Kab connection close hua.
- Real-time counters update.

<br>

**Example Scenario (Important)**:

Servers:
- A ‚Üí Processing time = 5 sec.
- B ‚Üí Processing time = 1 sec.

Traffic high.

Result:
- Server A ‚Üí Connections pile up.
- Server B ‚Üí Quickly free.

Least Connections:
- More new requests ‚Üí Server B.

<br>

**But Connection Count Always Accurate Load Metric Hai?**:

Not always.

Edge case:

Server A:
- 2 connections.
- But extremely CPU-heavy jobs.

Server B:
- 10 lightweight connections.

Least Connections Algorithm yaha ‚Üí A choose karega (wrong decision).

Isliye Weighted-Least Connection algorithm use hota hai.

<br>
<br>

### Least-Response Time:

Least-Response Time algorithm ka basic idea ye hai ki Jo backend server sabse fast response de raha hai, next request usko bhejo.

Matlab jo backend server sabse fast hai to next request usko behjo.

Example:
| Server | Avg Response Time |
| ------ | ----------------- |
| A      | 120 ms            |
| B      | 35 ms             |
| C      | 80 ms             |

New request ‚Üí Server B.

Because B fastest.

<br>

**Load Balancer Response Time Kaise Measure Karta Hai?**:

Load balancer continuously track karta:
- Request bhejne ka time.
- Response receive ka time.
- Difference = Latency.

Formula:
```
Response Time = Response_Received_Time - Request_Sent_Time
```

Phir moving averages maintain hoti hain.

<br>

**Moving Average kya hota hai?**

Moving average ka matlab hai ki pichle 10 ya 50 request ka average response time kya tha.

Seedhe shabdon mein: Load balancer sirf server ke pichle ek (last) response time ko nahi dekhta, balki pichli kuch requests (jaise last 10 ya 50 requests) ka ek average nikaalta hai. Isse "fluctuations" ya achanak aane wale spikes se bacha ja sakta hai.

Example:

Maan lijiye ek server ne ek request 10ms mein process ki, lekin agli request mein ek heavy database query ki wajah se usse 500ms lag gaye.
- Agar load balancer sirf last response dekhega, toh wo us server ko "slow" maan kar traffic rok dega.
- Lekin agar wo Moving Average dekhega, toh use pata chalega ki overall server abhi bhi fast hai, bas ek request slow thi.

<br>

**Why Moving Average Use Karte?**:

Single request misleading ho sakta.

Example:

Server A:
- Normally fast.
- Ek request slow due to GC pause.

Agar sirf last response dekhenge ‚Üí Wrong decision.

Isliye moving average dekhte hain.

<br>

**Weaknesses / Edge Cases**:

‚ùå Cold Start Problem

Server just started:
- No history.
- No response metrics.

Decision unstable ho sakta.

Solution:
- Warm-up logic / default routing.

<br>
<br>
